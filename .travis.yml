language: cpp

branches:
  except:
    - gh-pages

osx_image: xcode8.2
dist: trusty
sudo: required

matrix:
  exclude:
    - os: linux
    - os: osx

  include:
  - os: linux
    python: 2.7
    env: BUILD_TYPE=Debug OSSIA_STATIC=1 TOXENV=py27
  - os: linux
    python: 3.6
    env: BUILD_TYPE=Debug OSSIA_STATIC=1 TOXENV=py36
  - os: osx
    language: generic
    env: BUILD_TYPE=Debug OSSIA_STATIC=1 TOXENV=py27
  - os: osx
    language: generic
    env: BUILD_TYPE=Debug OSSIA_STATIC=1 TOXENV=py36

before_install:
- cd 3rdParty/libossia
- git submodule update --init
- cd ../../
- source ./scripts/split_repo_slug.sh

install: ./deps.sh

script: ./scripts/build.sh

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: ${SECURE_KEY}
  file: ./dist/${REPO}_${TRAVIS_TAG}_${TRAVIS_OS_NAME}.zip
  on:
    tags: true
    all_branches: true
    repo: PixelStereo/pyossia
