language: python

branches:
  except:
    - gh-pages

dist: trusty
sudo: required

matrix:
  exclude:
    - os: linux
    - os: osx

  include:
  - os: linux
    python: 3.6
    env: BUILD_TYPE=DOC
  - os: osx
    language: generic
    env: BUILD_TYPE=COVERAGE
    osx_image: xcode9

before_install: source ./scripts/split_repo_slug.sh

install: ./scripts/deps.sh

script: ./scripts/build.sh

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: ${GH_RELEASES}
  file: ${REPO}-${TRAVIS_TAG}-py3-none-${TRAVIS_OS_NAME}.whl
  on:
    tags: true
    all_branches: true
    repo: PixelStereo/pyossia

deploy:
  provider: pypi
  user: $PyPiUser
  password: $PyPiPsswd
  distributions: bdist_wheel
  on:
    tags: true
    all_branches: true
    repo: PixelStereo/pyossia
    condition: $TRAVIS_OS_NAME = linux
